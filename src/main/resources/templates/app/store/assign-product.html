<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/index}">

<head>
    <title>Assign Product</title>
</head>

<body>
<section layout:fragment="content">
    <div class="d-flex flex-wrap justify-content-between align-items-center mt-4 mb-3 gap-2">
        <div>
            <h1 class="fw-bold mb-1 fs-3">Assign Product</h1>
            <p class="text-muted mb-0 fs-6">Manage product assignments to stores</p>
        </div>
        <button id="btnAssignProduct" class="btn btn-primary">
            Assign Product
        </button>
    </div>

    <nav>
        <ol class="breadcrumb small mb-4">
            <li class="breadcrumb-item"><a th:href="@{/dashboard}">Dashboard</a></li>
            <li class="breadcrumb-item active">Assign Product</li>
        </ol>
    </nav>

    <form id="assignProductForm" th:object="${assignProduct}" method="post" th:action="@{/stores/assign-product}" class="needs-validation" novalidate>
        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-store me-1"></i>
                Search Store
            </div>
            <div class="card-body p-3">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="storeSelect" class="form-label">Store</label>
                        <select id="storeSelect" class="form-select" th:field="*{storeId}" th:errorclass="is-invalid">
                            <option value="" selected>Select Store</option>
                            <option th:each="store : ${stores}"
                                    th:value="${store.id}"
                                    th:data-phone="${store.phone}"
                                    th:text="${store.ruc}">
                            </option>
                        </select>
                        <div th:if="${#fields.hasErrors('storeId')}" th:errors="*{storeId}" class="text-danger small"></div>
                    </div>
                    <div class="col-md-6">
                        <label for="storePhone" class="form-label">Phone</label>
                        <input id="storePhone" class="form-control" readonly>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-box me-1"></i>
                Search Product
            </div>
            <div class="card-body p-3">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="productSelect" class="form-label">Product</label>
                        <select id="productSelect" class="form-select" th:field="*{productId}" th:errorclass="is-invalid">
                            <option value="" selected>Select Product</option>
                            <option th:each="product : ${products}"
                                    th:value="${product.id}"
                                    th:data-description="${product.description}"
                                    th:text="${product.name}">
                            </option>
                        </select>
                        <div th:if="${#fields.hasErrors('productId')}" th:errors="*{productId}" class="text-danger small"></div>
                    </div>
                    <div class="col-md-6">
                        <label for="productDescription" class="form-label">Description</label>
                        <input id="productDescription" class="form-control" readonly>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle mb-0">
            <thead class="table-light">
            <tr>
                <th>#</th>
                <th>Store</th>
                <th>Product</th>
                <th>Purchase</th>
                <th>Sale</th>
                <th>Stock</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="assign, iterStat : ${allProductAssignments}">
                <td th:text="${iterStat.index + 1}"></td>
                <td th:text="${assign.store.ruc}"></td>
                <td th:text="${assign.product.name}"></td>
                <td th:text="${assign.purchasePrice.toString()}"></td>
                <td th:text="${assign.salePrice.toString()}"></td>
                <td th:text="${assign.stock}"></td>
            </tr>
            <tr th:if="${#lists.isEmpty(allProductAssignments)}">
                <td colspan="5" class="text-center text-muted py-4">
                    No product assignments found.
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</section>

<section layout:fragment="scripts">
    <script>
        $(document).ready(function () {
            $('#storeSelect').on('change', function () {
                const selectedOption = $(this).find('option:selected');
                const storePhone = selectedOption.data('phone') || '';
                $('#storePhone').val(storePhone);
            });

            $('#productSelect').on('change', function () {
                const selectedOption = $(this).find('option:selected');
                const productDescription = selectedOption.data('description') || '';
                $('#productDescription').val(productDescription);
            });

            $('#btnAssignProduct').on('click', function (e) {
                e.preventDefault();
                $('#assignProductForm').submit();
            });
        });
    </script>
</section>

</body>
</html>
