<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/index}">

<head>
    <title>Purchases</title>
</head>

<body>
<section layout:fragment="content">
    <div class="d-flex flex-wrap justify-content-between align-items-center mt-4 mb-3 gap-2">
        <div>
            <h1 class="fw-bold mb-1 fs-3">Purchases</h1>
            <p class="text-muted mb-0 fs-6">Filter and review purchases by supplier, store, and date</p>
        </div>
    </div>

    <nav>
        <ol class="breadcrumb small mb-4">
            <li class="breadcrumb-item"><a th:href="@{/dashboard}">Dashboard</a></li>
            <li class="breadcrumb-item active">Purchases</li>
        </ol>
    </nav>

    <form method="get" th:action="@{/purchases}" class="row g-3 mb-4">
        <div class="col-md-3">
            <label for="startDateStr" class="form-label">Start Date</label>
            <input type="date" id="startDateStr" name="startDateStr"
                   onchange="this.form.submit()"
                   class="form-control"
                   th:value="${param.startDateStr}">
        </div>

        <div class="col-md-3">
            <label for="endDateStr" class="form-label">End Date</label>
            <input type="date" id="endDateStr" name="endDateStr"
                   onchange="this.form.submit()"
                   class="form-control"
                   th:value="${param.endDateStr}">
        </div>

        <div class="col-md-3">
            <label for="supplierId" class="form-label">Supplier</label>
            <select id="supplierId" name="supplierId" class="form-select" onchange="this.form.submit()">
                <option value="">All Suppliers</option>
                <option th:each="supplier : ${suppliers}"
                        th:value="${supplier.id}"
                        th:text="${supplier.name}"
                        th:selected="${param.supplierId != null and param.supplierId[0] == supplier.id.toString()}">
                </option>
            </select>
        </div>

        <div class="col-md-3">
            <label for="storeId" class="form-label">Store</label>
            <select id="storeId" name="storeId" class="form-select" onchange="this.form.submit()">
                <option value="">All Stores</option>
                <option th:each="store : ${stores}"
                        th:value="${store.id}"
                        th:text="${store.ruc}"
                        th:selected="${param.storeId != null and param.storeId[0] == store.id.toString()}">
                </option>
            </select>
        </div>
    </form>

    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle mb-0">
            <thead class="table-light">
            <tr>
                <th>#</th>
                <th>Supplier</th>
                <th>Store</th>
                <th>Date</th>
                <th>Purchase Price</th>
                <th>Sale Price</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="purchase, iterStat : ${purchases}">
                <td th:text="${iterStat.index + 1}"></td>
                <td th:text="${purchase.supplier.name}"></td>
                <td th:text="${purchase.store.ruc}"></td>
                <td th:text="${#temporals.format(purchase.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                <td th:text="${#numbers.formatDecimal(purchase.purchasePrice, 1, 'COMMA', 2, 'POINT')}"></td>
                <td th:text="${#numbers.formatDecimal(purchase.salePrice, 1, 'COMMA', 2, 'POINT')}"></td>
            </tr>
            <tr th:if="${purchases.isEmpty()}">
                <td colspan="4" class="text-center text-muted py-4">
                    No purchases found.
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <nav th:if="${purchases.totalPages > 1}" class="mt-3">
        <ul class="pagination justify-content-end mb-0">
            <li class="page-item" th:classappend="${purchases.first} ? 'disabled'">
                <a class="page-link" th:href="@{/purchases(page=${purchases.number - 1})}">Previous</a>
            </li>

            <li class="page-item"
                th:each="pageNum : ${#numbers.sequence(0, purchases.totalPages - 1)}"
                th:classappend="${pageNum == purchases.number} ? 'active'">
                <a class="page-link" th:href="@{/purchases(page=${pageNum})}"
                   th:text="${pageNum + 1}">1</a>
            </li>

            <li class="page-item" th:classappend="${purchases.last} ? 'disabled'">
                <a class="page-link" th:href="@{/purchases(page=${purchases.number + 1})}">Next</a>
            </li>
        </ul>
    </nav>
</section>
</body>
</html>
